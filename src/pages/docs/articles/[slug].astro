---
import { getCollection } from "astro:content";
import SiteLayout from "@/layouts/SiteLayout.astro";

// build-time: tell Astro which pages exist
export async function getStaticPaths() {
  const docs = await getCollection("docs");

  const articles = docs.filter((d) => d.id.startsWith("articles/"));

  if (!articles.length) return [];

  return await Promise.all(
    articles.map(async (entry) => {
      const slug = entry.id
        .replace(/^articles\//, "")
        .replace(/\.mdoc?$/, "")
        .replace(/\.mdx?$/, "");
      return {
        params: { slug },
        props: { entry },
      };
    })
  );
}

// runtime (well, build-time render): we get the entry from props
const { entry } = Astro.props;

if (!entry) {
  // this should basically never happen if getStaticPaths is correct
  throw new Error("Article not found");
}

const { Content } = await entry.render();
---

<SiteLayout title={entry.data.title ?? "Article"}>
  <article class="prose max-w-none">
    <p class="text-xs uppercase tracking-wide text-slate-400 mb-4">
      How-to
    </p>
    <h1>{entry.data.title ?? "Untitled article"}</h1>
    {entry.data.description && (
      <p class="text-slate-500 mb-6">{entry.data.description}</p>
    )}
    <Content />
  </article>
</SiteLayout>
